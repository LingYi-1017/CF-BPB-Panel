name: è‡ªåŠ¨æ„å»ºå¹¶æ··æ·†

on:
  push:
    branches: [main]
    paths:
      - "origin.js"
      - "auto-obfuscate.sh"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # ç¬¬ä¸€æ­¥ï¼šå¸¦æƒé™æ£€å‡º
      - name: âœ… æ£€å‡ºä»£ç  (å«å†™æƒé™)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}  # å…³é”®æƒé™é…ç½®

      # ç¬¬äºŒæ­¥ï¼šGit èº«ä»½è®¤è¯
      - name: ğŸ› ï¸ é…ç½® Git ç”¨æˆ·
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"

      # ç¬¬ä¸‰æ­¥ï¼šä»£ç åŒæ­¥
      - name: ğŸ”„ åŒæ­¥æœ€æ–°ä»£ç 
        run: git pull origin main --rebase

      # ç¬¬å››æ­¥ï¼šå®‰è£…ä¾èµ–
      - name: ğŸ“¦ å®‰è£…æ··æ·†å·¥å…·
        run: npm install -g javascript-obfuscator

      # ç¬¬äº”æ­¥ï¼šç”Ÿæˆæ–‡ä»¶
      - name: ğŸ›¡ï¸ æ‰§è¡Œæ··æ·†è„šæœ¬
        run: bash ./auto-obfuscate.sh

      # ç¬¬å…­æ­¥ï¼šå¼ºåˆ¶è®¤è¯æ¨é€
      - name: ğŸš€ æäº¤å¹¶æ¨é€æ›´æ”¹
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          branch: main
          commit_message: ":lock: è‡ªåŠ¨æ··æ·† _worker.js (åŸºäºæœ€æ–°ä»£ç )"
          file_pattern: |
            _worker.js
            obfuscation-log.txt
          commit_user_name: "github-actions[bot]"
          commit_user_email: "41898282+github-actions[bot]@users.noreply.github.com"
          # å¼ºåˆ¶ä½¿ç”¨ä»¤ç‰Œè®¤è¯
          token: ${{ secrets.GITHUB_TOKEN }}
