name: è‡ªåŠ¨æ„å»ºå¹¶æ··æ·†

on:
  push:
    branches: [main]
    paths:
      - "origin.js"
      - "auto-obfuscate.sh"
  workflow_dispatch:  # âœ… æ‰‹åŠ¨è§¦å‘æŒ‰é’®æ”¯æŒ

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # ç¬¬ä¸€æ­¥ï¼šå®Œæ•´æ£€å‡ºä»£ç åº“
      - name: âœ… æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # è·å–å®Œæ•´æäº¤å†å²ä»¥ä¾¿ rebase

      # ç¬¬äºŒæ­¥ï¼šé…ç½® Git èº«ä»½
      - name: ğŸ› ï¸ é…ç½® Git ç”¨æˆ·
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"

      # ç¬¬ä¸‰æ­¥ï¼šåŒæ­¥æœ€æ–°ä»£ç 
      - name: ğŸ”„ åŒæ­¥è¿œç¨‹ä»“åº“
        run: git pull origin main --rebase

      # ç¬¬å››æ­¥ï¼šå®‰è£…ä¾èµ–
      - name: ğŸ“¦ å®‰è£… JavaScript Obfuscator
        run: npm install -g javascript-obfuscator

      # ç¬¬äº”æ­¥ï¼šç”Ÿæˆæ··æ·†æ–‡ä»¶
      - name: ğŸ›¡ï¸ æ‰§è¡Œæ··æ·†è„šæœ¬
        run: bash ./auto-obfuscate.sh

      # ç¬¬å…­æ­¥ï¼šæäº¤å˜æ›´
      - name: ğŸ“® è‡ªåŠ¨æäº¤æ›´æ”¹
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          branch: main
          commit_message: ":lock: è‡ªåŠ¨æ··æ·† _worker.js (åŸºäºæœ€æ–°ä»£ç )"
          file_pattern: |
            _worker.js
            obfuscation-log.txt
          commit_author: "github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>"
